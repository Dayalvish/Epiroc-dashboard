<div style="color:red; font-size:10px; margin-bottom:10px;">SYSTEM ARCHITECTURE: V3.0</div>

<script>
    // UPDATE THIS URL ONE MORE TIME
    const API = "https://script.google.com/macros/s/AKfycbwqznwvTRppZnaKyEnztMN52yZQQCmyKDWDHn3LF5DR_pe-o5NWXokHsAnLjbwbVHU/exec";

    async function executeLogin() {
        const u = document.getElementById('userid').value.trim();
        const p = document.getElementById('userpass').value.trim();
        const err = document.getElementById('err-msg');
        const btn = document.getElementById('loginBtn');

        btn.innerText = "VERIFYING V3...";
        err.style.display = 'none';

        try {
            // We use encodeURIComponent to ensure symbols like '@' pass through
            const loginUrl = `${API}?get=login&user=${encodeURIComponent(u)}&pass=${encodeURIComponent(p)}`;
            const res = await fetch(loginUrl);
            const data = await res.json();

            if(data.success) {
                console.log("Login Success:", data);
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('main-dashboard').style.display = 'block';
                document.getElementById('view-title').innerText = `EPIROC - ${data.region.toUpperCase()}`;
                initDropdown();
            } else {
                err.innerText = "AUTH FAILED: " + (data.error || "Check Credentials");
                err.style.display = 'block';
                btn.innerText = "AUTHENTICATE & ENTER";
            }
        } catch (e) {
            alert("V3 Connection Error: " + e.message);
            btn.innerText = "AUTHENTICATE & ENTER";
        }
    }
</script>
